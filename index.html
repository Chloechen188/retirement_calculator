<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®šæœŸå®šé¡é€€ä¼‘é”æˆè¨ˆç®—æ©Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        .input-card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .label-style { display: block; font-size: 0.875rem; font-weight: 700; color: #374151; margin-bottom: 0.25rem; }
        .input-style { width: 100%; border: 1px solid #d1d5db; border-radius: 6px; padding: 0.6rem; font-size: 1rem; outline-color: #4f46e5; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <h1 class="text-3xl font-black text-indigo-900 mb-2">ğŸš€ å®šæœŸå®šé¡é€€ä¼‘è¨ˆç®—æ©Ÿ</h1>
        <p class="text-gray-500 mb-8">æ¡ç”¨ã€Œæœˆè¤‡åˆ©ã€æ¨¡å‹ï¼Œæ¨¡æ“¬æ¯æœˆ 1 è™Ÿæ‰£æ¬¾çš„çœŸå¯¦æŠ•è³‡ç‹€æ³</p>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- è¨­å®šå€ -->
            <div class="space-y-4">
                <div class="input-card">
                    <h2 class="text-indigo-600 font-bold mb-4 border-b pb-2">1. ç›®å‰ç¾æ³</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="label-style">ç›®å‰å¹´é½¡</label>
                            <input type="number" id="currentAge" value="30" class="input-style">
                        </div>
                        <div>
                            <label class="label-style">ç¾æœ‰è³‡ç”¢ç¸½é¡</label>
                            <input type="number" id="currentAsset" value="1000000" class="input-style">
                        </div>
                        <div>
                            <label class="label-style">æ¯æœˆæŠ•è³‡ </label>
                            <input type="number" id="monthlyInvest" value="50000" class="input-style">
                        </div>
                    </div>
                </div>

                <div class="input-card">
                    <h2 class="text-emerald-600 font-bold mb-4 border-b pb-2">2. é€€ä¼‘é¡˜æ™¯</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="label-style">é€€ä¼‘å¾Œæ¯æœˆç”Ÿæ´»è²» (ä»Šæ—¥è³¼è²·åŠ›)</label>
                            <input type="number" id="monthlySpend" value="40000" class="input-style">
                        </div>
                        <div>
                            <label class="label-style">é è¨ˆæ´»åˆ°å¹¾æ­²</label>
                            <input type="number" id="lifeAge" value="85" class="input-style">
                        </div>
                        <div>
                            <label class="label-style">å‹ä¿å¹´é‡‘ (65æ­²èµ·é ˜)</label>
                            <input type="number" id="pension" value="15000" class="input-style">
                        </div>
                    </div>
                </div>

                <div class="input-card">
                    <h2 class="text-orange-600 font-bold mb-4 border-b pb-2">3. ç¶“æ¿Ÿé æœŸ</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="label-style">é æœŸå¹´åŒ–å ±é…¬ç‡ (%)</label>
                            <input type="number" id="roi" value="6" class="input-style" step="0.1">
                        </div>
                        <div>
                            <label class="label-style">é ä¼°å¹´é€šè†¨ç‡ (%)</label>
                            <input type="number" id="inflation" value="2" class="input-style" step="0.1">
                        </div>
                    </div>
                    <button onclick="calculateGoal()" class="w-full mt-6 bg-indigo-600 text-white font-bold py-3 rounded-lg hover:bg-indigo-700 transition shadow-lg">
                        ç«‹å³è©¦ç®—
                    </button>
                </div>
            </div>

            <!-- çµæœå€ -->
            <div class="lg:col-span-2 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-indigo-600 p-6 rounded-2xl text-white">
                        <div class="text-indigo-100 text-sm">æœ€çŸ­é‚„éœ€å·¥ä½œ</div>
                        <div id="resWorkYears" class="text-4xl font-black mt-1">--</div>
                        <div id="resRetireAge" class="text-sm mt-2 opacity-80">é è¨ˆé€€ä¼‘å¹´é½¡ï¼š-- æ­²</div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border-2 border-indigo-100">
                        <div class="text-gray-500 text-sm">é€€ä¼‘ç•¶å¤©ç¸½è³‡ç”¢</div>
                        <div id="resTargetAsset" class="text-4xl font-black mt-1 text-indigo-600">--</div>
                        <div class="text-xs mt-2 text-gray-400">ç›¸ç•¶æ–¼ä»Šæ—¥è³¼è²·åŠ›</div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm">
                    <h3 class="font-bold text-gray-700 mb-4">ç”Ÿæ¶¯è³‡ç”¢è®Šå‹•æ›²ç·š (å·²æ‰£é™¤é€šè†¨)</h3>
                    <div class="h-[350px]">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>

                <div id="diagnosis" class="bg-indigo-50 p-6 rounded-2xl border-l-4 border-indigo-500 hidden">
                    <h4 class="font-bold text-indigo-900 mb-2 font-lg">ğŸ’¡ è©¦ç®—è¨ºæ–·ï¼š</h4>
                    <div id="diagnosisText" class="text-indigo-800 text-sm leading-relaxed"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let myChart = null;

        function calculateGoal() {
            const curAge = parseFloat(document.getElementById('currentAge').value) || 0;
            const curAsset = parseFloat(document.getElementById('currentAsset').value) || 0;
            const investM = parseFloat(document.getElementById('monthlyInvest').value) || 0;
            const spendM = parseFloat(document.getElementById('monthlySpend').value) || 0;
            const lifeAge = parseFloat(document.getElementById('lifeAge').value) || 0;
            const pensionVal = parseFloat(document.getElementById('pension').value) || 0;
            const roiRaw = parseFloat(document.getElementById('roi').value) / 100;
            const infRaw = parseFloat(document.getElementById('inflation').value) / 100;

            // è¨ˆç®—å¯¦è³ªå¹´å ±é…¬ç‡ (Fisher Equation)
            const realROIAnnum = (1 + roiRaw) / (1 + infRaw) - 1;
            // é—œéµä¿®æ”¹ï¼šå°‡å¹´åˆ©ç‡è½‰ç‚ºã€Œæœˆåˆ©ç‡ã€
            const monthlyRealROI = Math.pow(1 + realROIAnnum, 1 / 12) - 1;

            let finalWorkYears = 0;
            let success = false;
            let bestHistory = [];
            let retirementAssetAmount = 0;

            // æš´åŠ›æœå°‹æ³•ï¼šæ¸¬è©¦é‚„è¦å·¥ä½œå¹¾å¹´ (x)
            for (let x = 1; x <= (lifeAge - curAge); x++) {
                let assets = curAsset;
                let history = [];
                let retireAge = curAge + x;
                let isBroke = false;

                // ä»¥ã€Œæœˆã€ç‚ºå–®ä½é€²è¡Œæ¨¡æ“¬ï¼Œå¢åŠ æº–ç¢ºåº¦
                for (let age = curAge; age <= lifeAge; age++) {
                    for (let month = 1; month <= 12; month++) {
                        if (age < retireAge) {
                            // ç´¯ç©æœŸï¼šæœˆåˆæŠ•å…¥ + è¤‡åˆ©
                            assets = (assets + investM) * (1 + monthlyRealROI);
                        } else {
                            // æé ˜æœŸ
                            let currentPension = (age >= 65) ? pensionVal : 0;
                            // æœˆåˆé ˜éŒ¢é ˜å¹´é‡‘å¾Œï¼Œå‰©é¤˜è³‡ç”¢è¤‡åˆ©
                            assets = (assets - spendM + currentPension) * (1 + monthlyRealROI);
                        }
                    }
                    
                    history.push(Math.round(assets));
                    if (assets < 0 && age < lifeAge) { isBroke = true; }
                }

                if (!isBroke) {
                    finalWorkYears = x;
                    bestHistory = history;
                    retirementAssetAmount = history[x]; // é€€ä¼‘é‚£ä¸€å¹´çš„è³‡ç”¢
                    success = true;
                    break;
                }
                if (x === (lifeAge - curAge)) bestHistory = history;
            }

            // UI æ›´æ–°
            if (success) {
                document.getElementById('resWorkYears').innerText = finalWorkYears + " å¹´";
                document.getElementById('resRetireAge').innerText = "é è¨ˆé€€ä¼‘å¹´é½¡ï¼š" + (curAge + finalWorkYears) + " æ­²";
                document.getElementById('resTargetAsset').innerText = Math.round(retirementAssetAmount / 10000).toLocaleString() + " è¬å…ƒ";
                
                document.getElementById('diagnosis').classList.remove('hidden');
                document.getElementById('diagnosisText').innerHTML = `
                    å¦‚æœæ‚¨æ¯æœˆå®šæœŸå®šé¡æŠ•å…¥ <b>${investM.toLocaleString()}</b> å…ƒï¼Œ
                    ä¸”å¯¦è³ªå ±é…¬ç‡ç¶­æŒåœ¨ <b>${(realROIAnnum*100).toFixed(2)}%</b> (å·²æ‰£é™¤é€šè†¨)ï¼Œ
                    æ‚¨åœ¨ <b>${curAge + finalWorkYears}</b> æ­²æ™‚è³‡ç”¢å°‡é”åˆ°ç´„ <b>${Math.round(retirementAssetAmount / 10000)} è¬</b>ï¼Œ
                    é€™ç­†éŒ¢è¶³å¤ æ”¯æ’æ‚¨é€€ä¼‘å¾Œæ¯æœˆ <b>${spendM.toLocaleString()}</b> å…ƒçš„ç”Ÿæ´»è²»ç›´åˆ° ${lifeAge} æ­²ã€‚`;
            } else {
                document.getElementById('resWorkYears').innerText = "ç„¡æ³•é”æˆ";
                document.getElementById('resRetireAge').innerText = "å»ºè­°èª¿æ•´æŠ•è³‡é¡æˆ–å»¶å¾Œé€€ä¼‘";
                document.getElementById('resTargetAsset').innerText = "--";
                document.getElementById('diagnosis').classList.remove('hidden');
                document.getElementById('diagnosisText').innerText = "è­¦å‘Šï¼šç›®å‰çš„å„²è“„é€Ÿåº¦èˆ‡é æœŸå ±é…¬ç‡ï¼Œç„¡æ³•æ”¯æ’æ‚¨çš„é€€ä¼‘ç”Ÿæ´»é–‹éŠ·ã€‚å»ºè­°èª¿é«˜æ¯æœˆæŠ•è³‡é‡‘é¡ï¼Œæˆ–é™ä½é€€ä¼‘å¾Œçš„ç”Ÿæ´»æ”¯å‡ºéœ€æ±‚ã€‚";
            }

            drawChart(curAge, lifeAge, bestHistory);
        }

        function drawChart(curAge, lifeAge, dataHistory) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const labels = [];
            for (let i = curAge; i <= lifeAge; i++) labels.push(i + "æ­²");

            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'è³‡ç”¢å¯¦è³ªåƒ¹å€¼ (ä»Šæ—¥è³¼è²·åŠ›æŠ˜ç¾)',
                        data: dataHistory,
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        pointRadius: 0,
                        borderWidth: 3,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            ticks: { 
                                callback: (val) => {
                                    if (val < 0) return 0;
                                    return (val / 10000).toLocaleString() + 'è¬';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `è³‡ç”¢ï¼š${context.raw.toLocaleString()} å…ƒ`
                            }
                        }
                    }
                }
            });
        }

        window.onload = calculateGoal;
    </script>
</body>
</html>
