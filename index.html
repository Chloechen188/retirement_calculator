<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€€ä¼‘ç›®æ¨™é”æˆè¨ˆç®—æ©Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; }
        
        /* ç§»é™¤è¼¸å…¥æ¡†ä¸Šä¸‹ç®­é ­ */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        .input-card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .label-style { display: block; font-size: 0.875rem; font-weight: 700; color: #374151; margin-bottom: 0.25rem; }
        .input-style { width: 100%; border: 1px solid #d1d5db; border-radius: 6px; padding: 0.6rem; font-size: 1rem; outline-color: #4f46e5; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <h1 class="text-3xl font-black text-indigo-900 mb-2">ğŸš€ é€€ä¼‘ç›®æ¨™é”æˆè¨ˆç®—æ©Ÿ</h1>
        <p class="text-gray-500 mb-8">å°ˆæ³¨è¨ˆç®—ï¼šé‚„è¦å·¥ä½œå¤šä¹…ï¼Ÿé€€ä¼‘é‚£å¤©è¦å­˜åˆ°å¤šå°‘éŒ¢ï¼Ÿ</p>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- è¨­å®šå€ -->
            <div class="space-y-4">
                <div class="input-card">
                    <h2 class="text-indigo-600 font-bold mb-4 border-b pb-2">1. ç›®å‰ç¾æ³</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="label-style">ç›®å‰å¹´é½¡</label>
                            <input type="number" id="currentAge" value="35" class="input-style">
                        </div>
                        <div>
                            <label class="label-style">ç¾æœ‰è³‡ç”¢ç¸½é¡</label>
                            <input type="number" id="currentAsset" value="1000000" class="input-style">
                        </div>
                        <div>
                            <label class="label-style">æ¯æœˆæŠ•è³‡/å­˜æ¬¾ (Z)</label>
                            <input type="number" id="monthlyInvest" value="20000" class="input-style">
                        </div>
                    </div>
                </div>

                <div class="input-card">
                    <h2 class="text-emerald-600 font-bold mb-4 border-b pb-2">2. é€€ä¼‘é¡˜æ™¯</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="label-style">é€€ä¼‘å¾Œæ¯æœˆç”Ÿæ´»è²»</label>
                            <input type="number" id="monthlySpend" value="40000" class="input-style">
                        </div>
                        <div>
                            <label class="label-style">é è¨ˆæ´»åˆ°å¹¾æ­²</label>
                            <input type="number" id="lifeAge" value="90" class="input-style">
                        </div>
                        <div>
                            <label class="label-style">å‹ä¿å¹´é‡‘ (65æ­²èµ·æ¯æœˆé ˜)</label>
                            <input type="number" id="pension" value="20000" class="input-style">
                        </div>
                    </div>
                </div>

                <div class="input-card">
                    <h2 class="text-orange-600 font-bold mb-4 border-b pb-2">3. ç¶“æ¿Ÿé æœŸ</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="label-style">æŠ•è³‡å¹´å ±é…¬ç‡ (%)</label>
                            <input type="number" id="roi" value="7" class="input-style">
                        </div>
                        <div>
                            <label class="label-style">é ä¼°å¹´é€šè†¨ç‡ (%)</label>
                            <input type="number" id="inflation" value="2" class="input-style">
                        </div>
                    </div>
                    <button onclick="calculateGoal()" class="w-full mt-6 bg-indigo-600 text-white font-bold py-3 rounded-lg hover:bg-indigo-700 transition shadow-lg">
                        ç«‹å³è©¦ç®—
                    </button>
                </div>
            </div>

            <!-- çµæœå€ -->
            <div class="lg:col-span-2 space-y-6">
                <!-- æ•¸å­—çµæœ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-indigo-600 p-6 rounded-2xl text-white">
                        <div class="text-indigo-100 text-sm">æœ€çŸ­é‚„éœ€å·¥ä½œ</div>
                        <div id="resWorkYears" class="text-4xl font-black mt-1">--</div>
                        <div id="resRetireAge" class="text-sm mt-2 opacity-80">é è¨ˆé€€ä¼‘å¹´é½¡ï¼š-- æ­²</div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border-2 border-indigo-100">
                        <div class="text-gray-500 text-sm">é€€ä¼‘ç•¶å¤©ç›®æ¨™è³‡ç”¢</div>
                        <div id="resTargetAsset" class="text-4xl font-black mt-1 text-indigo-600">--</div>
                        <div class="text-xs mt-2 text-gray-400">ç›¸ç•¶æ–¼ä»Šæ—¥è³¼è²·åŠ›</div>
                    </div>
                </div>

                <!-- åœ–è¡¨ -->
                <div class="bg-white p-6 rounded-2xl shadow-sm">
                    <h3 class="font-bold text-gray-700 mb-4">ç”Ÿæ¶¯è²¡å¯Œè®Šå‹•æ›²ç·š (æ‰£é™¤é€šè†¨)</h3>
                    <div class="h-[350px]">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>

                <!-- è¨ºæ–·èªªæ˜ -->
                <div id="diagnosis" class="bg-indigo-50 p-6 rounded-2xl border-l-4 border-indigo-500 hidden">
                    <h4 class="font-bold text-indigo-900 mb-2 font-lg">ğŸ’¡ è©¦ç®—è¨ºæ–·ï¼š</h4>
                    <div id="diagnosisText" class="text-indigo-800 text-sm leading-relaxed"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let myChart = null;

        function calculateGoal() {
            // å–å¾—è¼¸å…¥å€¼
            const curAge = parseFloat(document.getElementById('currentAge').value) || 0;
            const curAsset = parseFloat(document.getElementById('currentAsset').value) || 0;
            const investZ = parseFloat(document.getElementById('monthlyInvest').value) || 0;
            const spendS = parseFloat(document.getElementById('monthlySpend').value) || 0;
            const lifeAge = parseFloat(document.getElementById('lifeAge').value) || 0;
            const pensionVal = parseFloat(document.getElementById('pension').value) || 0;
            const roiRaw = parseFloat(document.getElementById('roi').value) || 0;
            const infRaw = parseFloat(document.getElementById('inflation').value) || 0;

            // è¨ˆç®—å¯¦è³ªå ±é…¬ç‡
            const realROI = (1 + (roiRaw / 100)) / (1 + (infRaw / 100)) - 1;

            let finalWorkYears = 0;
            let success = false;
            let bestHistory = [];

            // æ¨¡æ“¬å·¥ä½œå¹´é™ï¼šå¾å·¥ä½œ 1 å¹´è©¦åˆ° 50 å¹´
            for (let x = 1; x <= 60; x++) {
                let assets = curAsset;
                let history = [];
                let retireAge = curAge + x;
                let isBroke = false;

                for (let age = curAge; age <= lifeAge; age++) {
                    if (age < retireAge) {
                        // å·¥ä½œç´¯ç©æœŸ
                        assets = (assets + (investZ * 12)) * (1 + realROI);
                    } else {
                        // é€€ä¼‘æé ˜æœŸ
                        // å‹ä¿å¹´é‡‘éš¨é€šè†¨æŠ˜ç¾
                        let realPension = (age >= 65) ? (pensionVal * 12) / Math.pow(1 + (infRaw/100), age - curAge) : 0;
                        assets = (assets - (spendS * 12) + realPension) * (1 + realROI);
                    }
                    history.push(Math.round(assets));
                    if (assets < 0) { isBroke = true; }
                }

                if (!isBroke) {
                    finalWorkYears = x;
                    bestHistory = history;
                    success = true;
                    break;
                }
                if (x === 60) bestHistory = history; // å³ä½¿æ²’æˆåŠŸä¹Ÿå­˜æœ€å¾Œä¸€æ¬¡æ­·å²åšåœ–
            }

            // æ›´æ–°é¡¯ç¤º
            if (success) {
                document.getElementById('resWorkYears').innerText = finalWorkYears + " å¹´";
                document.getElementById('resRetireAge').innerText = "é è¨ˆé€€ä¼‘å¹´é½¡ï¼š" + (curAge + finalWorkYears) + " æ­²";
                const targetVal = bestHistory[finalWorkYears];
                document.getElementById('resTargetAsset').innerText = Math.round(targetVal / 10000) + " è¬å…ƒ";
                
                document.getElementById('diagnosis').classList.remove('hidden');
                document.getElementById('diagnosisText').innerHTML = `ä¾ç…§ç›®å‰çš„å„²è“„é€Ÿåº¦ï¼Œæ‚¨é‚„éœ€è¦å·¥ä½œ <b>${finalWorkYears}</b> å¹´ã€‚åˆ°é€€ä¼‘é‚£å¤©ï¼Œæ‚¨çš„è³‡ç”¢éœ€ç´¯ç©åˆ° <b>${Math.round(targetVal / 10000)} è¬</b>ï¼Œæ‰èƒ½ç¢ºä¿åœ¨é€€ä¼‘å¾Œæ¯æœˆæé ˜ ${spendS.toLocaleString()} å…ƒç›´åˆ° ${lifeAge} æ­²ã€‚`;
            } else {
                document.getElementById('resWorkYears').innerText = "éœ€è¦æ›´ä¹…";
                document.getElementById('resRetireAge').innerText = "ç›®å‰å„²è“„ä¸è¶³ä»¥æ”¯æ’é€€ä¼‘";
                document.getElementById('resTargetAsset').innerText = "--";
                document.getElementById('diagnosis').classList.remove('hidden');
                document.getElementById('diagnosisText').innerText = "è­¦å‘Šï¼šç›®å‰çš„æŠ•è³‡é¡æˆ–å ±é…¬ç‡å¤ªä½ï¼Œç„¡æ³•æ”¯æ’é€€ä¼‘æ”¯å‡ºã€‚å»ºè­°æé«˜æ¯æœˆæŠ•è³‡é‡‘é¡æˆ–é™ä½é€€ä¼‘å¾Œçš„é è¨ˆé–‹éŠ·ã€‚";
            }

            // ç•«åœ–
            drawChart(curAge, lifeAge, bestHistory);
        }

        function drawChart(curAge, lifeAge, dataHistory) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const labels = [];
            for (let i = curAge; i <= lifeAge; i++) labels.push(i + "æ­²");

            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'è³‡ç”¢å¯¦è³ªåƒ¹å€¼ (ä»Šæ—¥è³¼è²·åŠ›)',
                        data: dataHistory,
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        pointRadius: 0,
                        borderWidth: 3,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            ticks: { callback: (val) => (val / 10000).toLocaleString() + 'è¬' }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // åˆå§‹åŒ–ç¬¬ä¸€æ¬¡è©¦ç®—
        window.onload = calculateGoal;
    </script>
</body>
</html>